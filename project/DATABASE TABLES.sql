CREATE BANKING_APPLCATION;

CREATE SCHEMA BANK_APP;

CREATE TABLE bank_app.ADMIN(
	ADMIN_ID SERIAL,
	ADMIN_NAME VARCHAR(30) NOT NULL,
	EMAIL VARCHAR(50) UNIQUE NOT NULL,
	CONSTRAINT ADMIN_ID PRIMARY KEY(ADMIN_ID)
);

CREATE TABLE bank_app.CUSTOMER(
	CUST_ID SERIAL,
	CUST_NAME VARCHAR(30) NOT NULL,
	GENDER VARCHAR(6) NOT NULL,
	MOBILE VARCHAR(10) UNIQUE NOT NULL,
	EMAIL VARCHAR(50) UNIQUE NOT NULL,
	AADHAAR VARCHAR(12)UNIQUE NOT NULL,
	ADDRESS VARCHAR(30) NOT NULL,
	CONSTRAINT PK_CUSTID PRIMARY KEY(CUST_ID),
	CONSTRAINT GENDER_TYPE CHECK(GENDER IN ('MALE','FEMALE','OTHERS'))
);

CREATE TABLE bank_app.USER(
	USER_ID VARCHAR(30),
	PASSWORD VARCHAR(20) NOT NULL,
	USER_TYPE VARCHAR(7) NOT NULL,
	CUST_ID INT,
	ADMIN_ID INT,
	CONSTRAINT PK_USERID PRIMARY KEY(USER_ID),
	CONSTRAINT USER_TYPE CHECK (USER_TYPE IN ('ADMIN','CUSTOMER')),
	CONSTRAINT FK_ADMINID FOREIGN KEY(ADMIN_ID) REFERENCES bank_app.ADMIN(ADMIN_ID),
	CONSTRAINT FK_CUSTID FOREIGN KEY(CUST_ID) REFERENCES bank_app.CUSTOMER(CUST_ID)
);

CREATE TABLE bank_app.ACCOUNT(
	ACCOUNT_NO INT GENERATED BY DEFAULT AS IDENTITY(START WITH 90000),
	CREATED_ON DATE NOT NULL,
	BALANCE DECIMAL(10,2) NOT NULL CHECK(BALANCE>=0),
	CUST_ID INT NOT NULL,
	CONSTRAINT PK_ACCOUNTNO PRIMARY KEY(ACCOUNT_NO),
	CONSTRAINT FK_CUSTID FOREIGN KEY(CUST_ID) REFERENCES bank_app.CUSTOMER(CUST_ID)
);

CREATE TABLE bank_app.BANK_TX(
	TX_ID SERIAL,
	TX_DATE DATE NOT NULL,
	TX_TYPE VARCHAR(6) NOT NULL,
	AMOUNT DECIMAL(10,2) NOT NULL CHECK(AMOUNT>0),
	ACCOUNT_NO INT NOT NULL,
	ADMIN_ID INT NOT NULL,
	CONSTRAINT PK_TXID PRIMARY KEY(TX_ID),
	CONSTRAINT TX_TYPE CHECK(TX_TYPE IN('DEBIT','CREDIT')),
	CONSTRAINT FK_ACCOUNTID FOREIGN KEY(ACCOUNT_NO) REFERENCES bank_app.ACCOUNT(ACCOUNT_NO),
	CONSTRAINT FK_ADMINID FOREIGN KEY(ADMIN_ID) REFERENCES bank_app.ADMIN(ADMIN_ID)
);

CREATE TABLE bank_app.TX_FLOW(
	SENDER_TX INT NOT NULL,
	RECIPIENT_TX INT NOT NULL,
	CONSTRAINT CK_TX PRIMARY KEY(SENDER_TX,RECIPIENT_TX),
	CONSTRAINT FK_TX_S FOREIGN KEY(SENDER_TX) REFERENCES bank_app.BANK_TX(TX_ID),
	CONSTRAINT FK_TX_R FOREIGN KEY(RECIPIENT_TX) REFERENCES bank_app.BANK_TX(TX_ID)
);